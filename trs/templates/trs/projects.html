{% extends "trs/base.html" %}
{% load trs_formatting %}

{% block full-width %}
  <h1>Projecten</h1>
  <div class="text-muted">
    {% if view.no_filters %}
      <span>Actieve projecten</span>
    {% else %}
      <a href="?">Toon actieve projecten</a>
    {% endif %}
    |
    <a href="?archived=true">Gearchiveerd</a> |
  </div>
  {# The filter list in 'projects-simple.html' is less elaborate #}

  <div class="text-muted">
    <a href="?is_subsidized=true&archived=false&ended=false&started=true">
      Actieve subsidieprojecten
    </a> |
    <a href="?is_subsidized=true">Alle subsidieprojecten</a>
  </div>
  <div class="text-muted">
    <a href="?is_accepted=true&archived=false&ended=false&started=true">
      Actief en goedgekeurd
    </a> |
    <a href="?is_accepted=false&archived=false&ended=false&started=true">
      Actief en <i>niet</i> goedgekeurd
    </a>
  </div>

  <table class="table table-hover table-condensed table-fixed-header">
    <thead class="header">
      <tr>
        <th>Project</th>
        <th>Omschrijving</th>
        <th class="text-right">Verliesuren</th>
        <th class="text-right">Opdrachtsom</th>
        <th class="text-right">Omzet</th>
        <th class="text-right">Extra kosten</th>
        <th class="text-right"
            title="Inclusief nog niet betaalde facturen">Gefactureerd</th>
        <th class="text-right">
          Gefact.<br>
          t.o.v.<br>
          opdrachtsom
        </th>
        <th class="text-right">
          Gefact.<br>
          t.o.v.<br>
          omzet + kosten
        </th>
      </tr>
    </thead>
    <tbody>
      {% for line in view.lines %}
        <tr>
          <td style="white-space: nowrap;">
            {{ line.project.as_widget }}
          </td>
          <td>
            <span class="text-muted"
                  {% if line.project.description|length > 30 %}
                    title="{{ line.project.description }}"
                  {% endif %}>
              {{ line.project.description|truncatechars:30 }}
            </span>
          </td>
          <td class="text-right {{ line.klass }}">
            {{ line.project.overbooked|hours }}
          </td>
          <td class="text-right">
            {{ line.project.contract_amount|money }}
          </td>
          <td class="text-right">
            {{ line.turnover|money }}
          </td>
          <td class="text-right">
            {{ line.costs|money }}
          </td>
          <td class="text-right">
            {{ line.invoice_amount|money_with_decimal }}
          </td>
          <td class="text-right">
            {% if line.invoice_amount_percentage != None %}
              {{ line.invoice_amount_percentage }}%
            {% endif %}
          </td>
          <td class="text-right">
            {% if line.invoice_versus_turnover_percentage != None %}
              {{ line.invoice_versus_turnover_percentage }}%
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% if view.can_add_project %}
    <hr>
    <p>
      <a href="{% url 'trs.project.new' %}" class="btn btn-default">
        <span class="glyphicon glyphicon-plus"></span>
        Voeg nieuw project toe
      </a>
    </p>
  {% endif %}
{% endblock %}

{% block overview-column %}
  <!-- TODO: this isn't shown anymore -->
  {% if view.can_see_everything %}
    <h1>Totaal</h1>
    <div>Verhouding gefactureerd t.o.v. opdrachtsom:</div>
    <div style="font-size: 500%">
      {{ view.total_invoice_amount_percentage.percentage }}%
    </div>
    <div>
      Totaal gefactureerd:
      {{ view.total_invoice_amount_percentage.invoice_amount|money }}
    </div>
    <div>
      Totaal opdrachtsommen:
      {{ view.total_invoice_amount_percentage.contract_amount|money }}
    </div>

  {% endif %}
{% endblock %}
