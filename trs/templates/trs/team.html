{% extends "trs/base.html" %}
{% load trs_formatting %}

{% block main-column %}
  <h1>{{ view.title }}</h1>
  {{ view.back_url }}

  {% for error in form.errors.values %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endfor %}

  <form action="." method="post">
    {% csrf_token %}
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Persoon</th>
          <th class="text-right">Uren</th>
          <th class="text-right text-muted">(Al geboekt)</th>
          <th></th>
          <th class="text-right">Uurtarief</th>
          <th class="text-right text-muted">Standaardtarief</th>
          <th class="text-right">Kosten</th>
        </tr>
      </thead>
      <tbody>
        {% for line in view.lines %}
          <tr>
            <td>{{ line.person.as_widget }}</td>
            <td class="text-right">
              {% for error in line.hours.errors %}
                <div class="alert alert-danger">{{ error }}</div>
              {% endfor %}
              {{ line.hours }}
            </td>
            <td class="text-right text-muted">{{ line.booked|hours }}</td>
            <td>
              {% if line.deletable %}
                <a href="{% url 'trs.project.team-member-delete' pk=view.project.pk person_pk=line.person.pk %}">
                  <span class="glyphicon glyphicon-minus-sign text-danger"></span>
                </a>
              {% endif %}
            </td>
            <td class="text-right">
              {% for error in line.hourly_tariff.errors %}
                <div class="alert alert-danger">{{ error }}</div>
              {% endfor %}
              {{ line.hourly_tariff }}
            </td>
            <td class="text-right text-muted">
              <span title="Minimum: {{ line.person.minimum_hourly_tariff }}">
                {{ line.person.standard_hourly_tariff|money }}
              </span>
            </td>
            <td class="text-right">
              {{ line.costs|money }}
            </td>
          </tr>
        {% endfor %}
      </tbody>

      {% if view.can_add_team_member %}
        <tbody>
          <tr>
            <td>Nieuw teamlid:</td>
            <td colspan="6"  class="text-right">
              {{ view.new_team_member_field }}
            </td>
          </tr>
        </tbody>
      {% endif %}

      <tbody>
        <tr>
          <td colspan="6">Reservering toekomstig werk</td>
          <th class="text-right">
              {% for error in view.reservation_field.errors %}
                <div class="alert alert-danger">{{ error }}</div>
              {% endfor %}
            {{ view.reservation_field }}
          </th>
        </tr>
        <tr>
          <td colspan="6">Afdracht</td>
          <th class="text-right">
              {% for error in view.profit_field.errors %}
                <div class="alert alert-danger">{{ error }}</div>
              {% endfor %}
            {{ view.profit_field }}
          </th>
        </tr>
        <tr>
          <td colspan="6">Subtotaal</td>
          <th class="text-right">{{ view.person_costs_incl_reservation|money }}</th>
        </tr>
      </tbody>

      <tfoot>
        <tr>
          <th colspan="7" class="text-right">
            <input type="submit"
                   class="btn btn-primary"
                   tabindex="{{ view.tabindex_submit_button|default:99 }}"
                   value="Submit" /></th>
        </tr>
      </tfoot>
    </table>
  </form>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">
        Overzicht projectbegroting
        <small>ter info</small>
      </h2>
    </div>
    <div class="panel-body">

      <table class="table">
        <thead>
          <tr>
            <th>Omschrijving</th>
            <th class="text-right">Kosten</th>
            <th class="text-right">Inkomsten</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Opdrachtsom</td>
            <td class="text-right"></td>
            <td class="text-right">{{ view.project.contract_amount|money }}</td>
          </tr>
          <tr>
            <td>Personele kosten incl. reserveringen en afdracht</td>
            <td class="text-right">{{ view.person_costs_incl_reservation|money }}</td>
            <td class="text-right"></td>
          </tr>
          <tr>
            <td>Overige kosten incl. overschrijvingen</td>
            <td class="text-right">{{ view.project.costs|money }}</td>
            <td class="text-right">{{ view.project.income|money }}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <th>Totaal</th>
            <th class="text-right">
              {{ view.total_costs|money }}
            </th>
            <th class="text-right">
              {{ view.total_income|money }}
            </th>
          </tr>
          <tr>
            <th>Nog te verdelen</th>
            <th class="text-right">{{ view.project.left_to_dish_out|money }}</th>
            <td class="text-right"></td>
          </tr>
        </tfoot>
      </table>

    </div>
  </div>

{% endblock %}

{% block overview-column %}
{% endblock %}
