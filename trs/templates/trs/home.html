{% extends "trs/base.html" %}
{% load trs_formatting %}

{% block main-column %}
  <h1>Tijdregistratiesysteem & projectoverzicht</h1>

  {% if view.are_there_changes %}
    <p>
      Bij deze de relevante veranderingen vanaf
      {{ view.start_week.first_day }}
    </p>

    <div class="row">
      <div class="col-md-6">
        {% if view.person_changes %}
          <!-- Changes on you -->

          <div class="panel panel-default">
            <div class="panel-heading">
              Verandering aan jouw instellingen
            </div>
            <div class="panel-body">
              {% if view.person_changes.hours_per_week__sum %}
                <div>
                  <b>Werkweek:</b>
                  {{ view.person_changes.hours_per_week__sum|hoursdiff }}
                </div>
              {% endif %}
              {% if view.person_changes.target__sum %}
                <div>
                  <b>Target:</b>
                  {{ view.person_changes.target__sum|moneydiff }}
                </div>
              {% endif %}
              {% if view.person_changes.standard_hourly_tariff__sum %}
                <div>
                  <b>Standaard uurtarief:</b>
                  {{ view.person_changes.standard_hourly_tariff__sum|moneydiff }}
                </div>
              {% endif %}
              {% if view.person_changes.minimum_hourly_tariff__sum %}
                <div>
                  <b>Minimum uurtarief:</b>
                  {{ view.person_changes.minimum_hourly_tariff__sum|moneydiff }}
                </div>
              {% endif %}
            </div>
          </div>
        {% endif %}

        {% for change in view.work_changes %}
          <div class="panel panel-default">
            <div class="panel-heading">
              Verandering aan je werk op
              {{ change.project.as_widget }}<br>
              <span class="text-muted">{{ change.project.description }}</span>
            </div>
            <div class="panel-body">
              {% if change.hours__sum %}
                <div>
                  <b>Toegekende uren:</b>
                  {{ change.hours__sum|hoursdiff }}
                </div>
              {% endif %}
              {% if change.hourly_tariff__sum %}
                <div>
                  <b>Uurtarief:</b>
                  {{ change.hourly_tariff__sum|hoursdiff }}
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}

        <div class="panel panel-default">
          <div class="panel-heading">
            Resterende vakantieuren
          </div>
          <div class="panel-body">
            {% if view.vacation_left %}
              <b>In weken:</b> {{ view.vacation_left.weeks|floatformat }}<br>
              <b>In uren:</b> {{ view.vacation_left.hours }}
            {% else %}
              Hm. Geen project gevonden dat 'verlof' heet. Jammer, dat wordt
              doorwerken dit jaar.
            {% endif %}
          </div>
        </div>

      </div>
      <div class="col-md-6">
        <!-- Changes on your projects -->

        {% for change in view.project_budget_changes %}
          <div class="panel panel-default">
            <div class="panel-heading">
              Budgetverandering aan jouw project
              {{ change.project.as_widget }}<br>
              <span class="text-muted">{{ change.project.description }}</span>
            </div>
            <div class="panel-body">
              {% if change.budget__sum %}
                <div>
                  <b>Budget:</b>
                  {{ change.budget__sum|moneydiff }}
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}

        {% for change in view.project_invoice_changes %}
          <div class="panel panel-default">
            <div class="panel-heading">
              Nieuwe of betaalde facturen bij jouw project
              {{ change.project.as_widget }}<br>
              <span class="text-muted">{{ change.project.description }}</span>
            </div>
            <div class="panel-body">
              {% for invoice in change.added %}
                <div>
                  <b>Nieuw:</b>
                  {{ invoice.number }}:
                  <span class="text-muted">
                    {{ invoice.description }}
                  </span>
                  &agrave;
                  &euro;{{ invoice.amount_exclusive|money }}
                </div>
              {% endfor %}
              {% for invoice in change.payed %}
                <div>
                  <b>Betaald:</b>
                  {{ invoice.number }}:
                  <span class="text-muted">
                    {{ invoice.description }}
                  </span>
                  &agrave;
                  &euro;{{ invoice.amount_exclusive|money }}
                </div>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

  {% else %}
    <p>Er zijn de laatste tijd geen wijzigingen.</p>
  {% endif %}

{% endblock %}
